<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Configure seu bairro e dias de coleta">
  <title>Configura√ß√£o - EcoAlerta Floripa</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="container">
    <header>
      <h1>üå± EcoAlerta Floripa</h1>
      <p>Configure sua coleta</p>
    </header>

    <nav role="navigation" aria-label="Navega√ß√£o principal">
      <a href="index.html">Home</a>
      <a href="config.html" class="active" aria-current="page">Configurar</a>
      <a href="report.html">Reportar</a>
      <a href="guide.html">Guia</a>
      <a href="history.html">Hist√≥rico</a>
    </nav>

    <main role="main">
      <h2>‚öôÔ∏è Configura√ß√£o</h2>
      
      <div class="card">
        <p class="text-muted mb-2">
          Informe seu bairro e selecione os dias e hor√°rios da coleta de lixo. 
          Essas informa√ß√µes ser√£o usadas para calcular a pr√≥xima coleta.
        </p>
      </div>

      <form id="formConfig" aria-label="Formul√°rio de configura√ß√£o">
        <div class="form-group">
          <label for="selectBairro">Bairro *</label>
          <select id="selectBairro" name="bairro" required aria-required="true">
            <option value="">Selecione seu bairro</option>
          </select>
        </div>

        <div class="form-group">
          <label>Dias e Hor√°rios de Coleta *</label>
          <p class="text-muted" style="font-size: 0.9rem; margin-bottom: 0.75rem;">
            Selecione os dias em que o caminh√£o de lixo passa no seu bairro.
            Os hor√°rios padr√£o ser√£o preenchidos automaticamente.
          </p>
          <div id="checkboxDias" class="checkbox-group" role="group" aria-label="Dias de coleta"></div>
        </div>

        <div class="card" style="background: var(--bg-light); border: 1px solid var(--border-color);">
          <p style="font-size: 0.9rem; margin-bottom: 0;">
            üí° <strong>Dica:</strong> Os hor√°rios s√£o preenchidos automaticamente com base no seu bairro. 
            Voc√™ pode ajust√°-los se necess√°rio marcando/desmarcando os dias.
          </p>
        </div>

        <div class="btn-group mt-3">
          <button type="submit" class="btn" aria-label="Salvar configura√ß√£o">
            Salvar Configura√ß√£o
          </button>
        </div>

        <div class="btn-group">
          <a href="index.html" class="btn btn-outline" aria-label="Cancelar e voltar">
            Cancelar
          </a>
        </div>
      </form>
    </main>
  </div>

  <script src="app.js"></script>
  <script>
    let calendarData = {};
    let configAtual = null;

    async function init() {
      try {
        const response = await fetch('calendar.json');
        calendarData = await response.json();
        configAtual = loadConfig();
        popularBairros();
        
        if (configAtual && configAtual.bairro) {
          document.getElementById('selectBairro').value = configAtual.bairro;
          atualizarDias(configAtual.bairro);
          
          if (configAtual.dias && configAtual.dias.length > 0) {
            configAtual.dias.forEach(dia => {
              const checkbox = document.querySelector(`input[value="${dia}"]`);
              if (checkbox) checkbox.checked = true;
            });
          }
        }
        
      } catch (error) {
        console.error('Erro ao carregar dados:', error);
        showToast('Erro ao carregar dados de configura√ß√£o', 5000);
      }
    }

    function popularBairros() {
      const select = document.getElementById('selectBairro');
      const bairros = Object.keys(calendarData).sort();
      
      bairros.forEach(bairro => {
        const option = document.createElement('option');
        option.value = bairro;
        option.textContent = bairro;
        select.appendChild(option);
      });
    }

    document.getElementById('selectBairro').addEventListener('change', function(e) {
      const bairro = e.target.value;
      if (bairro) {
        atualizarDias(bairro);
      } else {
        document.getElementById('checkboxDias').innerHTML = 
          '<p class="text-muted">Selecione um bairro primeiro</p>';
      }
    });

    function atualizarDias(bairro) {
      const container = document.getElementById('checkboxDias');
      const dias = calendarData[bairro] || [];
      
      if (dias.length === 0) {
        container.innerHTML = '<p class="text-muted">Nenhum dia dispon√≠vel para este bairro</p>';
        return;
      }
      
      container.innerHTML = '';
      
      dias.forEach((dia, index) => {
        const id = `dia${index}`;
        const div = document.createElement('div');
        div.className = 'checkbox-item';
        
        const checkbox = document.createElement('input');
        checkbox.type = 'checkbox';
        checkbox.id = id;
        checkbox.name = 'dias';
        checkbox.value = dia;
        checkbox.checked = true;
        
        const label = document.createElement('label');
        label.htmlFor = id;
        label.textContent = dia;
        
        div.appendChild(checkbox);
        div.appendChild(label);
        container.appendChild(div);
      });
    }

    document.getElementById('formConfig').addEventListener('submit', function(e) {
      e.preventDefault();
      
      const bairro = document.getElementById('selectBairro').value;
      
      if (!bairro) {
        showToast('Por favor, selecione um bairro', 3000);
        return;
      }
      
      const checkboxes = document.querySelectorAll('input[name="dias"]:checked');
      const dias = Array.from(checkboxes).map(cb => cb.value);
      
      if (dias.length === 0) {
        showToast('Selecione pelo menos um dia de coleta', 3000);
        return;
      }
      
      const config = { bairro, dias };
      const sucesso = saveConfig(config);
      
      if (sucesso) {
        showToast('‚úÖ Configura√ß√£o salva com sucesso!', 2000);
        
        setTimeout(() => {
          window.location.href = 'index.html';
        }, 2000);
      } else {
        showToast('Erro ao salvar configura√ß√£o. Tente novamente.', 4000);
      }
    });

    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', init);
    } else {
      init();
    }
  </script>
</body>
</html>

